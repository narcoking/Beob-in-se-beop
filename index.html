<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>법인세법 퀴즈 대작전! 🕵️‍♀️</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js CDN for sound effects -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.min.js"></script>
    <style>
        /* Inter font setting */
        body {
            font-family: 'Inter', sans-serif;
            /* Apply background and text color for the entire body using Tailwind's dark: prefix */
            /* Default light mode colors */
            @apply bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4;
            transition: background-color 0.3s ease, color 0.3s ease; /* Add smooth transition effect */
        }
        /* Scrollbar design (optional) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
            @apply dark:bg-gray-700; /* Dark mode scrollbar track */
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
            @apply dark:bg-gray-500; /* Dark mode scrollbar thumb */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
            @apply dark:bg-gray-400; /* Dark mode scrollbar thumb hover */
        }

        /* --- Dark Mode Specific Overrides (Stronger Application for text visibility) --- */
        /* Ensure body background changes directly when html has 'dark' class and text becomes very light */
        html.dark body {
            background-color: #111827 !important; /* Tailwind's gray-900 equivalent */
            color: #f9fafb !important; /* Tailwind's gray-100 equivalent - general text color */
        }
        /* Ensure quiz-container background changes directly and its child texts are bright */
        html.dark #quiz-container {
            background-color: #1f2937 !important; /* Tailwind's gray-800 equivalent */
        }

        /* Force specific text elements to be white in dark mode */
        html.dark #start-screen h1,
        html.dark #start-screen p,
        html.dark #quiz-header #question-count,
        html.dark #quiz-header #timer-display,
        html.dark #question-text,
        html.dark #feedback-text,
        html.dark #explanation-text,
        html.dark #end-quiz-screen h2,
        html.dark #incorrect-count-display {
            color: #f9fafb !important; /* Tailwind's gray-100 - very light almost white */
        }

        /* MODIFIED: Ensure feedback-explanation-area background changes in dark mode */
        html.dark #feedback-explanation-area {
            background-color: #1f2937 !important; /* Tailwind's gray-800 equivalent for the explanation box */
            border-color: #4b5563 !important; /* Dark mode border color */
        }


        /* Choices text color in dark mode - APPLY !IMPORTANT HERE more directly */
        html.dark #question-choices-area > div {
            color: #f9fafb !important; /* Ensures choice text is white in dark mode */
            background-color: #374151 !important; /* Tailwind gray-700 equivalent */
            border-color: #4b5563 !important; /* Tailwind gray-600 equivalent */
        }

        /* Override specific class text colors for dark mode */
        .text-gray-700 { /* For start screen P tags, question count, timer, incorrect count */
            @apply dark:text-gray-100 !important;
        }
        .text-gray-800 { /* For H1, H2, Question text */
            @apply dark:text-gray-100 !important;
        }
        .text-blue-600 { /* For scores etc. */
             @apply dark:text-blue-400 !important; /* Keep blue for scores but make it dark-mode friendly */
        }

        /* Specific dark mode styles for choice buttons */
        #question-choices-area > div.hover\:bg-blue-50:hover {
            @apply dark:hover:bg-blue-900 dark:hover:bg-opacity-20;
        }

        /* MODIFIED: Changed selected choice background and added distinct blue border for dark mode */
        #question-choices-area > div.bg-blue-200 { /* selected choice in light mode */
            /* Existing light mode styles */
        }
        html.dark #question-choices-area > div.bg-blue-200 { /* selected choice in dark mode */
            background-color: #2a3547 !important; /* Slightly lighter than gray-800, darker than gray-700 for distinct selection */
            border-color: #60a5fa !important; /* Tailwind blue-400 for a clear blue border */
            border-width: 2px !important; /* Make border more visible */
            /* Removed ring as border is now used for highlight */
        }

        #question-choices-area > div.bg-green-100 { /* correct answer feedback */
            @apply dark:bg-green-700 dark:border-green-400;
        }
        #question-choices-area > div.bg-green-200 { /* selected correct answer */
            @apply dark:bg-green-600 dark:border-green-300;
        }
        #question-choices-area > div.bg-red-200 { /* selected incorrect answer */
            @apply dark:bg-red-600 dark:border-red-300;
        }

        /* --- Dark Mode for Message Box --- */
        html.dark #message-box > div { /* Inner div of the message box */
            background-color: #1f2937 !important; /* Darker background */
            color: #f9fafb !important; /* Light text for consistency */
        }

        html.dark #message-text { /* Text inside the message box */
            color: #f9fafb !important; /* Ensure message text is light */
        }

        /* Message box button for dark mode (using existing gradient, but ensuring text is visible) */
        html.dark #message-ok-btn {
            color: #ffffff !important; /* Explicitly ensure white text on button */
        }
    </style>
</head>
<body>
    <div id="quiz-container" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-2xl transition-colors duration-300 relative">
        <!-- Settings Controls (Top Right) -->
        <div id="settings-controls" class="absolute top-4 right-4 flex space-x-2">
            <!-- Dark Mode Toggle -->
            <button id="dark-mode-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition duration-300 ease-in-out hover:scale-110">
                <!-- Sun icon (default: shown in light mode) -->
                <svg id="sun-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1m-16 0H3m15.325-7.325l-.707-.707M6.343 17.657l-.707.707M17.657 6.343l.707-.707M6.343 6.343l-.707-.707"></path>
                </svg>
                <!-- Moon icon (hidden by default, shown in dark mode) -->
                <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </button>
            <!-- Sound Toggle -->
            <button id="sound-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition duration-300 ease-in-out transform hover:scale-110">
                <!-- Speaker icon (default: shown when sound is on) -->
                <svg id="speaker-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9l1.414-1.414M7.05 18.95a5 5 0 010-7.072M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <!-- Mute icon (hidden by default, shown when sound is off) -->
                <svg id="mute-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
                </svg>
            </button>
        </div>

        <!-- Start screen -->
        <div id="start-screen" class="text-center p-6 space-y-4">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-6">법인세법 퀴즈 대작전! 🕵️‍♀️</h1>
            <p class="text-lg text-gray-700 dark:text-gray-300 mb-8">몇 문제 풀어볼까? 숫자 버튼을 눌러줘! 👇</p>
            <div class="space-y-4">
                <!-- Start 10 questions button with pastel gradient -->
                <button id="start-10-btn" class="w-full bg-gradient-to-r from-blue-200 to-blue-400 hover:from-blue-300 hover:to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    10문제 도전! 🚀
                </button>
                <!-- Start 20 questions button with pastel gradient -->
                <button id="start-20-btn" class="w-full bg-gradient-to-r from-green-200 to-green-400 hover:from-green-300 hover:to-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    20문제 용감하게! 🌟
                </button>
                <!-- Start 40 questions button with pastel gradient -->
                <button id="start-40-btn" class="w-full bg-gradient-to-r from-purple-200 to-purple-400 hover:from-purple-300 hover:to-purple-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    40문제 척척박사! 🌈
                </button>
            </div>
        </div>

        <!-- Quiz screen -->
        <div id="quiz-screen" class="hidden w-full">
            <!-- Quiz header: Question number, score, and Timer -->
            <div id="quiz-header" class="flex justify-between items-center w-full mb-6">
                <p id="question-count" class="text-lg font-semibold text-gray-700 dark:text-gray-300">문제 0 / 0</p>
                <p id="timer-display" class="text-lg font-semibold text-gray-700 dark:text-gray-300">00:00</p>
                <p id="score-display" class="text-lg font-semibold text-blue-600 dark:text-blue-400">별 점수: 0 ✨</p>
            </div>

            <!-- Question text -->
            <p id="question-text" class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6"></p>

            <!-- Choices area -->
            <div id="question-choices-area" class="w-full space-y-4 mb-6">
                <!-- Choices will be dynamically inserted here -->
                <div class="p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition duration-200 ease-in-out text-gray-800 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" data-choice="O">O (동그라미)</div>
                <div class="p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition duration-200 ease-in-out text-gray-800 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" data-choice="X">X (엑스)</div>
            </div>

            <!-- Feedback and explanation area -->
            <div id="feedback-explanation-area" class="w-full bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-600 hidden">
                <p id="feedback-text" class="font-semibold mb-2"></p>
                <p id="explanation-text" class="text-gray-700 dark:text-gray-300 text-sm"></p>
            </div>

            <!-- Quiz control buttons -->
            <div id="quiz-controls" class="w-full flex justify-between mt-6">
                <!-- Check Answer / Next Question button with pastel gradient -->
                <button id="check-next-btn" class="bg-gradient-to-r from-indigo-200 to-indigo-400 hover:from-indigo-300 hover:to-indigo-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    다음 문제로 Go! 👉
                </button>
                <!-- End Early button with pastel gradient -->
                <button id="end-early-btn" class="bg-gradient-to-r from-red-200 to-red-400 hover:from-red-300 hover:to-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    퀴즈 이제 그만! 멈춰! ✋
                </button>
            </div>
        </div>

        <!-- End quiz screen -->
        <div id="end-quiz-screen" class="text-center p-6 space-y-4 hidden w-full">
            <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-4">퀴즈 끝! 정말 멋진 도전이었어! ✨</h2>
            <p id="final-score" class="text-2xl text-blue-600 dark:text-blue-400 font-bold mb-6">최종 점수: 0점</p>
            <div id="end-quiz-buttons-area" class="space-y-4">
                <!-- Restart Full Quiz button with pastel gradient -->
                <button id="restart-full-quiz-btn" class="w-full bg-gradient-to-r from-blue-200 to-blue-400 hover:from-blue-300 hover:to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    처음부터 다시! 🐥
                </button>
                <!-- Review Incorrect button with pastel gradient -->
                <button id="review-incorrect-btn" class="w-full bg-gradient-to-r from-yellow-200 to-yellow-400 hover:from-yellow-300 hover:to-yellow-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    틀린 문제 복습! 🧠
                </button>
                <!-- Go To Home button with pastel gradient -->
                <button id="go-to-home-btn" class="w-full bg-gradient-to-r from-gray-200 to-gray-400 hover:from-gray-300 hover:to-gray-500 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    처음 화면으로! 🏠
                </button>
            </div>
        </div>
    </div>

    <!-- Custom message box -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-xl text-center w-80">
            <p id="message-text" class="text-lg font-semibold mb-4 text-gray-800 dark:text-gray-100"></p>
            <button id="message-ok-btn" class="bg-gradient-to-r from-blue-200 to-blue-400 hover:from-blue-300 hover:to-blue-500 text-white font-bold py-2 px-4 rounded-lg">좋아! 😊</button>
        </div>
    </div>

    <script>
        // ============================ Cache DOM elements ============================
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const endQuizScreen = document.getElementById('end-quiz-screen');

        const start10Button = document.getElementById('start-10-btn');
        const start20Button = document.getElementById('start-20-btn');
        const start40Button = document.getElementById('start-40-btn');

        const quizHeader = document.getElementById('quiz-header');
        const questionCount = document.getElementById('question-count');
        const timerDisplay = document.getElementById('timer-display'); // Added timer display element
        const scoreDisplay = document.getElementById('score-display');
        const questionText = document.getElementById('question-text');
        const questionChoicesArea = document.getElementById('question-choices-area');
        const feedbackExplanationArea = document.getElementById('feedback-explanation-area');
        const feedbackText = document.getElementById('feedback-text');
        const explanationText = document.getElementById('explanation-text');
        const quizControls = document.getElementById('quiz-controls');
        const checkNextButton = document.getElementById('check-next-btn');
        const endEarlyButton = document.getElementById('end-early-btn');

        const finalScoreDisplay = document.getElementById('final-score');
        const endQuizButtonsArea = document.getElementById('end-quiz-buttons-area'); // Added
        const restartFullQuizButton = document.getElementById('restart-full-quiz-btn');
        const reviewIncorrectButton = document.getElementById('review-incorrect-btn');
        const goToHomeButton = document.getElementById('go-to-home-btn');

        const settingsControls = document.getElementById('settings-controls'); // Settings button container
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const moonIcon = document.getElementById('moon-icon');
        const sunIcon = document.getElementById('sun-icon');
        const soundToggle = document.getElementById('sound-toggle');
        const speakerIcon = document.getElementById('speaker-icon');
        const muteIcon = document.getElementById('mute-icon');

        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const messageOkButton = document.getElementById('message-ok-btn');

        // ============================ Global variables and quiz data ============================
        let allQuizData = []; // Array to store all quiz data
        let currentQuizData = []; // Array of questions for the current quiz session
        let incorrectQuestions = []; // Array to store incorrect questions
        let currentQuestionIndex = 0;
        let score = 0; // Raw score (number of correct answers)
        let selectedChoice = null; // Changed to store 'O' or 'X'
        let isAnswerChecked = false; // Flag for answer check status
        let quizTotalQuestions = 0; // Total number of questions for the current quiz session (set at start)
        let isSoundEnabled = true; // Sound active status
        let timer = 0; // Timer in seconds
        let timerIntervalId = null; // ID to clear the interval

        // Tone.js PolySynth (synthesizer that can play multiple notes simultaneously)
        const polySynth = new Tone.PolySynth(Tone.Synth).toDestination();

        // ============================ Custom message box functions ============================
        /**
         * Function to display a message to the user (replaces alert)
         * @param {string} message - Text message to display
         */
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            // Hide message box and remove event listener when 'OK' button is clicked
            messageOkButton.addEventListener('click', hideMessage, { once: true });
        }

        /**
         * Function to hide the message box
         */
        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        // ============================ Sound effect functions ============================
        /**
         * Checks Tone.start() and Tone.Destination.mute status before playing sound
         * @returns {Promise<void>}
         */
        async function ensureAudioContextAndSound() {
            if (Tone.context.state !== 'running') {
                await Tone.start();
            }
            // Set Tone.Destination.mute based on isSoundEnabled status
            Tone.Destination.mute = !isSoundEnabled;
        }

        /**
         * Sound played when the answer is correct
         */
        async function playCorrectSound() {
            await ensureAudioContextAndSound();
            if (isSoundEnabled) {
                polySynth.triggerAttackRelease("C5", "8n"); // Play C5 note for 8th note duration
            }
        }

        /**
         * Sound played when the answer is incorrect
         */
        async function playIncorrectSound() {
            await ensureAudioContextAndSound();
            if (isSoundEnabled) {
                polySynth.triggerAttackRelease("C3", "8n"); // Play C3 note for 8th note duration
            }
        }

        /**
         * Sound played when quiz starts or restarts (uses chord)
         */
        async function playStartSound() {
            await ensureAudioContextAndSound();
            if (isSoundEnabled) {
                polySynth.triggerAttackRelease(["C4", "E4", "G4"], "8n"); // Short ascending chord (C Major)
            }
        }

        /**
         * Sound played when quiz ends (uses chord)
         */
        async function playEndSound() {
            await ensureAudioContextAndSound();
            if (isSoundEnabled) {
                polySynth.triggerAttackRelease(["A3", "C4", "E4"], "4n"); // Short, low descending sound (A Minor)
            }
        }

        /**
         * Sound played on general button click or choice selection
         */
        async function playButtonClickSound() {
            await ensureAudioContextAndSound();
            if (isSoundEnabled) {
                polySynth.triggerAttackRelease("G4", "32n"); // Very short click sound
            }
        }

        // ============================ Embed quiz data ============================
        const corporationTaxQuizData = [
            {
                question: "내국법인의 각 사업연도 소득에 대한 법인세는 법인세법에 특별한 규정이 없으면 각 사업연도 소득에 20%의 세율을 적용하여 계산한다. (O/X)",
                answer: "X",
                explanation: "법인세율은 과세표준 구간에 따라 누진세율이 적용된다."
            },
            {
                question: "비영리내국법인이 수익사업에서 발생한 소득이 없는 경우에는 법인세 신고의무가 없다. (O/X)",
                answer: "X",
                explanation: "수익사업이 없더라도 고유목적사업준비금 등의 조정을 위해 신고의무가 있을 수 있다."
            },
            {
                question: "법인세법상 내국법인의 각 사업연도 소득금액 계산 시 익금총액에서 손금총액을 공제한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "내국법인의 각 사업연도 소득금액 계산 시 손금산입되는 퇴직급여충당금은 기업회계기준상 설정액을 전액 인정한다. (O/X)",
                answer: "X",
                explanation: "세법상 퇴직급여충당금 손금산입 한도가 정해져 있다."
            },
            {
                question: "주식회사가 자기주식을 취득하여 소각하는 경우, 그 소각익은 법인세법상 익금에 해당하지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인이 자산을 시가보다 낮은 가액으로 양도한 경우, 해당 양도손실은 법인세법상 손금에 해당한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 배당으로 보는 금액에 해당하는 간주배당금은 소득처분에 의해 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "비상장법인의 주식을 양도하여 발생하는 양도차익은 법인세법상 각 사업연도 소득에 포함되지 않는다. (O/X)",
                answer: "O",
                explanation: "주식 양도차익은 법인세가 아닌 양도소득세 과세대상이다."
            },
            {
                question: "법인이 임원에게 지급하는 상여금은 정관 또는 주주총회 등의 결의에 의해 정해진 한도를 초과하는 경우 손금불산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인이 업무와 관련 없이 특수관계인에게 지급한 가지급금의 이자는 손금불산입된다. (O/X)",
                answer: "X",
                explanation: "가지급금의 이자는 익금산입된다."
            },
            {
                question: "법인세법상 접대비는 건당 3만원을 초과하는 경우 적격증빙을 수취하지 않으면 손금불산입된다. (O/X)",
                answer: "O",
                explanation: "현행 3만원으로 상향."
            },
            {
                question: "접대비의 손금산입 한도는 수입금액에 따라 차등 적용되며, 일정 한도를 초과하는 금액은 손금불산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인이 임직원에게 지급하는 복리후생비는 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "특정 복리후생비는 비과세 근로소득에 해당하나, 과도하거나 업무무관성이 있는 경우 손금불산입될 수 있다."
            },
            {
                question: "감가상각비는 기업회계기준에 따라 계상한 금액을 전액 손금으로 인정한다. (O/X)",
                answer: "X",
                explanation: "세법상 감가상각 시부인 계산을 통해 손금산입 한도가 정해진다."
            },
            {
                question: "감가상각의 방법은 정액법, 정률법, 생산량비례법, 연수합계법 중 법인이 선택할 수 있다. (O/X)",
                answer: "X",
                explanation: "세법상 정액법과 정률법 중 선택하며, 건축물 등은 정액법을 강제한다."
            },
            {
                question: "법인이 취득한 토지의 취득세는 토지의 취득원가에 가산하여 손금산입된다. (O/X)",
                answer: "X",
                explanation: "토지는 비상각자산이므로 감가상각 대상이 아니며, 취득원가에 포함된다."
            },
            {
                question: "법인세법상 손금불산입되는 자산의 평가손실은 재고자산에 대해서만 허용된다. (O/X)",
                answer: "X",
                explanation: "특정 유형자산 등에 대해서도 예외적으로 평가손실을 인정하는 경우가 있다."
            },
            {
                question: "법인이 보유하고 있는 유가증권의 평가손실은 법인세법상 원칙적으로 손금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인이 특수관계인에게 정당한 사유 없이 금전을 무상 또는 낮은 이율로 대여한 경우, 부당행위계산부인 규정이 적용될 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "부당행위계산부인 시 적용되는 시가는 상속세 및 증여세법상 평가규정을 준용한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인이 특수관계인으로부터 자산을 시가보다 높은 가액으로 매입한 경우, 시가를 초과하는 금액은 손금불산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 이월결손금은 발생 사업연도 종료일로부터 15년 이내에 발생한 이월결손금에 한하여 공제할 수 있다. (O/X)",
                answer: "O",
                explanation: "2020년 1월 1일 이후 개시하는 사업연도부터 15년으로 연장."
            },
            {
                question: "중소기업의 경우 이월결손금 공제한도는 각 사업연도 소득금액의 80%이다. (O/X)",
                answer: "X",
                explanation: "중소기업은 이월결손금 전액 공제가 가능하며, 일반법인만 80% 제한이 있다."
            },
            {
                question: "법인세법상 세액공제는 원칙적으로 최저한세의 적용을 받는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 외국납부세액은 외국법인세액 전액을 세액공제 또는 손금산입할 수 있다. (O/X)",
                answer: "X",
                explanation: "외국납부세액 공제 한도가 정해져 있다."
            },
            {
                question: "법인세법상 비과세소득은 법인세 과세표준 계산 시 익금에 산입하지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 면제소득은 법인세 과세표준에 포함되지만, 세액 계산 시 해당 소득에 대한 세액은 면제된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 최저한세는 조세특례제한법상의 감면세액에만 적용된다. (O/X)",
                answer: "X",
                explanation: "최저한세는 감면세액뿐만 아니라 특정 비과세소득 등에도 적용될 수 있다."
            },
            {
                question: "법인세법상 사업연도는 법령이나 정관에 특별한 규정이 없으면 1년을 초과하지 못한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 사업연도는 법인이 임의로 변경할 수 없다. (O/X)",
                answer: "X",
                explanation: "사업연도 변경은 관할 세무서장의 승인을 받아야 한다."
            },
            {
                question: "법인세법상 중간예납세액은 직전 사업연도 법인세액의 50%에 해당하는 금액이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 중간예납 의무가 없는 법인은 신설법인과 직전 사업연도 법인세 납부세액이 없는 법인 등이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 수정신고는 납세지 관할 세무서장에게 제출한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 경정청구는 법정신고기한이 지난 후 5년 이내에 할 수 있다. (O/X)",
                answer: "O",
                explanation: "국세기본법에 따라 5년으로 연장."
            },
            {
                question: "법인세법상 부가가치세는 원칙적으로 손금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: "부가가치세는 소비자가 부담하는 세금으로, 법인의 손익에 직접 영향을 미치지 않는다."
            },
            {
                question: "법인세법상 토지와 건물을 일괄 취득하는 경우, 각 자산의 취득가액은 시가에 따라 안분한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 재고자산의 평가방법은 선입선출법, 후입선출법, 이동평균법 등이 있다. (O/X)",
                answer: "X",
                explanation: "후입선출법은 세법상 인정되지 않는다."
            },
            {
                question: "법인세법상 주식발행초과금은 자본거래로 인한 잉여금으로 익금에 해당하지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 국고보조금은 원칙적으로 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: "단, 특정 국고보조금은 조건 충족 시 익금불산입될 수 있다."
            },
            {
                question: "법인세법상 건설자금 이자는 자본화대상이며, 손금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 채무면제이익은 원칙적으로 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 외화환산이익은 원칙적으로 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 대손금은 회수할 수 없는 채권으로, 요건 충족 시 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 대손충당금은 기업회계기준상 설정액을 전액 인정한다. (O/X)",
                answer: "X",
                explanation: "세법상 대손충당금 손금산입 한도가 정해져 있다."
            },
            {
                question: "법인세법상 자산수증이익은 원칙적으로 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 자기주식처분이익은 익금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 재해손실세액공제는 각 사업연도 소득금액에서 공제된다. (O/X)",
                answer: "X",
                explanation: "재해손실세액공제는 산출세액에서 공제되는 세액공제이다."
            },
            {
                question: "법인세법상 투자세액공제는 중소기업에게만 적용된다. (O/X)",
                answer: "X",
                explanation: "일반기업도 투자세액공제를 받을 수 있는 경우가 있다."
            },
            {
                question: "법인세법상 퇴직연금보험료는 전액 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 기부금은 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "기부금은 지정기부금과 비지정기부금으로 구분되며, 각각 한도가 적용된다."
            },
            {
                question: "내국법인이 국외에 사업장이 있는 경우에도 국내에서만 법인세를 납부한다. (O/X)",
                answer: "X",
                explanation: "국외사업장에서 발생한 소득에 대해서도 법인세 납세의무가 있다."
            },
            {
                question: "비영리법인이 고유목적사업을 위해 출연받은 재산은 법인세법상 수익사업에서 발생한 소득으로 본다. (O/X)",
                answer: "X",
                explanation: "원칙적으로 수익사업 소득으로 보지 않는다."
            },
            {
                question: "합병의 경우 피합병법인의 이월결손금은 합병법인에게 승계되지 않는다. (O/X)",
                answer: "X",
                explanation: "특정 요건을 충족하는 경우 승계될 수 있다."
            },
            {
                question: "분할의 경우 분할법인의 이월결손금은 분할신설법인에게 승계되지 않는다. (O/X)",
                answer: "X",
                explanation: "특정 요건을 충족하는 경우 승계될 수 있다."
            },
            {
                question: "법인세법상 외국법인의 국내원천소득에 대해서는 원천징수 규정이 적용될 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 유동화전문회사는 각 사업연도 소득에 대한 법인세를 감면받을 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 명의신탁재산의 증여의제는 적용되지 않는다. (O/X)",
                answer: "X",
                explanation: "상속세 및 증여세법에 따른 명의신탁 증여의제가 적용될 수 있다."
            },
            {
                question: "법인세법상 지주회사의 수입배당금 익금불산입 규정은 모든 배당금에 적용된다. (O/X)",
                answer: "X",
                explanation: "지분율 등 특정 요건을 충족하는 경우에만 적용된다."
            },
            {
                question: "법인세법상 업무용 승용차 관련 비용은 한도 없이 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "업무용 승용차 관련 비용은 한도가 정해져 있다."
            },
            {
                question: "법인세법상 업무용 승용차의 처분손실은 한도 없이 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "업무용 승용차의 처분손실도 한도가 정해져 있다."
            },
            {
                question: "법인세법상 특수관계인과의 거래에서 발생한 부당행위계산 부인은 세무조정을 통해 이루어진다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 자본금과 적립금 조정명세서는 법인세 신고 시 필수적으로 제출해야 하는 서류이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 법인세 과세표준은 각 사업연도 소득금액에서 이월결손금, 비과세소득, 소득공제를 차감하여 계산한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 농업법인은 법인세를 면제받을 수 있다. (O/X)",
                answer: "X",
                explanation: "특정 소득에 대해 감면이 있을 수 있으나 전액 면제는 아니다."
            },
            {
                question: "법인세법상 주식매수선택권 행사이익은 법인의 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 손금불산입되는 기부금은 이월하여 공제받을 수 없다. (O/X)",
                answer: "X",
                explanation: "특정 기부금은 이월하여 공제받을 수 있다."
            },
            {
                question: "법인세법상 소액광고선전비는 접대비 한도에 포함되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 경조금은 접대비로 보지 않는다. (O/X)",
                answer: "X",
                explanation: "경조금도 접대비에 해당하며, 한도가 적용된다."
            },
            {
                question: "법인세법상 국외 특수관계인과의 거래에서 발생한 소득은 국제조세조정에 관한 법률에 따라 조정될 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 지급이자는 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "채권자불분명사채 이자, 업무무관 가지급금 이자 등 손금불산입되는 경우가 있다."
            },
            {
                question: "법인세법상 퇴직보험료는 손금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "퇴직보험료는 손금에 산입된다."
            },
            {
                question: "법인세법상 유형자산의 양도손익은 각 사업연도 소득에 포함된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 무형자산의 상각은 정액법에 의해서만 할 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 연구 및 인력개발비는 세액공제 대상이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 고정자산의 재평가차액은 익금에 산입된다. (O/X)",
                answer: "X",
                explanation: "재평가차액은 자본잉여금으로 익금에 해당하지 않는다."
            },
            {
                question: "법인세법상 고유목적사업준비금은 비영리법인에 한하여 설정할 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 고유목적사업준비금은 설정 후 5년 이내에 사용해야 한다. (O/X)",
                answer: "X",
                explanation: "5년 또는 10년 이내에 사용해야 하며, 일부는 사용기한 제한이 없다."
            },
            {
                question: "법인세법상 퇴직급여충당금 설정 대상은 임직원 모두를 포함한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 퇴직연금충당금은 손금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "퇴직연금충당금은 손금에 산입된다."
            },
            {
                question: "법인세법상 건설중인자산은 감가상각 대상이 아니다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 자본적 지출은 감가상각을 통해 손금화된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 수익적 지출은 즉시 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 합병평가차익은 익금에 산입된다. (O/X)",
                answer: "X",
                explanation: "합병평가차익은 자본잉여금으로 익금에 해당하지 않는다."
            },
            {
                question: "법인세법상 분할평가차익은 익금에 산입된다. (O/X)",
                answer: "X",
                explanation: "분할평가차익은 자본잉여금으로 익금에 해당하지 않는다."
            },
            {
                question: "법인세법상 주식의 포괄적 교환은 과세되지 않는다. (O/X)",
                answer: "X",
                explanation: "특정 요건을 충족하는 경우 과세이연이 가능할 수 있으나, 원칙적으로 과세된다."
            },
            {
                question: "법인세법상 연결납세방식을 선택한 법인은 개별법인세액을 계산하여 납부한다. (O/X)",
                answer: "X",
                explanation: "연결납세방식은 연결법인 전체의 소득을 기준으로 계산한다."
            },
            {
                question: "법인세법상 성실신고확인제도는 모든 법인에 적용된다. (O/X)",
                answer: "X",
                explanation: "특정 요건을 충족하는 법인에 한하여 적용된다."
            },
            {
                question: "법인세법상 국제조세조정에 관한 법률은 외국법인과의 거래에만 적용된다. (O/X)",
                answer: "X",
                explanation: "내국법인과 국외 특수관계인과의 거래에도 적용된다."
            },
            {
                question: "법인세법상 가산세는 과태료에 해당한다. (O/X)",
                answer: "X",
                explanation: "가산세는 세법상 의무 불이행에 대한 벌금 성격이다."
            },
            {
                question: "법인세법상 수정세금계산서 발급 시 공급가액은 변경될 수 없다. (O/X)",
                answer: "X",
                explanation: "수정세금계산서는 공급가액 등 오류를 수정하는 경우 발행한다."
            },
            {
                question: "법인세법상 현물출자는 원칙적으로 양도차익이 발생한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 적격 물적분할은 과세이연된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 자기주식처분손실은 손금불산입된다. (O/X)",
                answer: "X",
                explanation: "자기주식처분손실은 손금불산입된다. 다만, 자기주식소각손실은 손금산입될 수 있다."
            },
            {
                question: "법인세법상 신용카드매출전표 등 발행세액공제는 모든 법인에게 적용된다. (O/X)",
                answer: "X",
                explanation: "주로 개인사업자에게 적용되며, 법인에게는 제한적으로 적용된다."
            },
            {
                question: "법인세법상 외국자회사로부터 받은 배당금은 전액 익금불산입된다. (O/X)",
                answer: "X",
                explanation: "지분율 등 요건 충족 시 익금불산입될 수 있으나, 전액은 아니다."
            },
            {
                question: "법인세법상 업무용 차량의 리스료는 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "업무용 승용차 관련 비용 한도 적용을 받는다."
            },
            {
                question: "법인세법상 금융기관에 예치된 예금 이자는 전액 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 고유목적사업준비금은 이자소득에 대해서는 설정할 수 없다. (O/X)",
                answer: "X",
                explanation: "특정 이자소득에 대해서도 설정이 가능하다."
            },
            {
                question: "법인세법상 자산재평가법에 따른 재평가는 임의사항이다. (O/X)",
                answer: "X",
                explanation: "과거에 있었던 자산재평가법은 현재는 시행되지 않는다."
            },
            {
                question: "법인세법상 소득세법에 따라 원천징수된 소득은 법인세 과세표준에 포함되지 않는다. (O/X)",
                answer: "X",
                explanation: "원천징수된 소득도 법인세 과세대상이며, 기납부세액으로 차감된다."
            },
            {
                question: "법인세법상 법인의 해산은 사업연도 종료로 본다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 청산소득에 대한 법인세는 청산종결일이 속하는 달의 말일부터 3개월 이내에 신고 납부한다. (O/X)",
                answer: "X",
                explanation: "청산소득 법인세는 잔여재산가액 확정일로부터 3개월 이내 신고 납부한다."
            },
            {
                question: "법인세법상 결손금 소급공제는 모든 법인에 적용된다. (O/X)",
                answer: "X",
                explanation: "중소기업에 한하여 적용된다."
            },
            {
                question: "법인세법상 세금과 공과금은 원칙적으로 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 벌금, 과료, 과징금 등은 원칙적으로 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "원칙적으로 손금불산입된다."
            },
            {
                question: "법인세법상 업무무관 비용은 손금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 임원의 퇴직금은 정관 또는 주주총회 결의에 의해 정해진 한도를 초과하는 경우 손금불산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 국외원천소득이 있는 법인은 외국납부세액 공제 또는 손금산입 중 선택할 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 과세표준은 각 사업연도 소득금액에서 세액공제를 차감한 금액이다. (O/X)",
                answer: "X",
                explanation: "과세표준은 소득금액에서 이월결손금, 비과세소득, 소득공제를 차감한 금액이며, 세액공제는 산출세액에서 차감한다."
            },
            {
                question: "법인세법상 현물배당은 익금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "현물배당도 익금에 산입될 수 있다."
            },
            {
                question: "법인세법상 합병법인이 피합병법인의 자산을 시가보다 높은 가액으로 취득한 경우, 그 차액은 합병차손익으로 보지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 자산의 증여는 증여이익이 발생하는 경우 익금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 채무의 인수는 원칙적으로 익금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "채무인수로 인해 이익이 발생하는 경우 익금에 산입된다."
            },
            {
                question: "법인세법상 임차보증금은 원칙적으로 익금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 토지 등의 양도소득에 대한 법인세는 일반 법인세율과 동일하게 적용된다. (O/X)",
                answer: "X",
                explanation: "토지 등 양도소득에 대해서는 추가 세율이 적용될 수 있다."
            },
            {
                question: "법인세법상 해외금융계좌 신고의무는 내국법인에게만 적용된다. (O/X)",
                answer: "X",
                explanation: "외국법인에게도 적용될 수 있다."
            },
            {
                question: "법인세법상 법인세 납세지는 법인의 등기부상 본점 또는 주사무소의 소재지이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 법인의 해산은 합병, 분할에 의한 해산도 포함한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 비상장주식의 양도차익에 대해서는 예정신고 의무가 없다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 조세회피 목적의 합병은 과세되지 않는다. (O/X)",
                answer: "X",
                explanation: "조세회피 목적의 합병은 부당행위계산 부인 규정이 적용될 수 있다."
            },
            {
                question: "법인세법상 주식소각익은 익금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 퇴직연금 미설정 법인의 임직원에게 지급하는 퇴직급여는 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "세법상 한도 초과분은 손금불산입될 수 있다."
            },
            {
                question: "법인세법상 신용카드 수수료는 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 금융리스자산의 감가상각은 리스이용자가 한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 운용리스자산의 감가상각은 리스제공자가 한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 법인의 채무보증으로 인한 구상채권 포기액은 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "원칙적으로 손금불산입된다. 다만, 특정 요건 충족 시 손금산입될 수 있다."
            },
            {
                question: "법인세법상 대주주에게 지급하는 배당금은 법인세법상 익금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "대주주에게 지급하는 배당금도 익금에 산입된다."
            },
            {
                question: "법인세법상 중소기업특별세액감면은 농업법인에게는 적용되지 않는다. (O/X)",
                answer: "X",
                explanation: "농업법인도 중소기업특별세액감면을 적용받을 수 있다."
            },
            {
                question: "법인세법상 연구개발비는 전액 손금에 산입된다. (O/X)",
                answer: "X",
                explanation: "연구개발비는 자산화 또는 비용화 선택이 가능하며, 세액공제 대상이 될 수 있다."
            },
            {
                question: "법인세법상 세무조정계산서는 법인세 신고 시 필수적으로 제출해야 하는 서류이다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 외부감사 대상 법인은 세무조정계산서 제출 시 세무조정계산서에 대한 외부감사의견을 첨부해야 한다. (O/X)",
                answer: "X",
                explanation: "외부감사 대상 법인은 재무제표에 대한 외부감사의견을 첨부한다."
            },
            {
                question: "법인세법상 법인의 합병으로 인한 자산의 취득가액은 장부가액을 원칙으로 한다. (O/X)",
                answer: "X",
                explanation: "시가를 원칙으로 한다. 다만, 적격합병의 경우 장부가액을 승계할 수 있다."
            },
            {
                question: "법인세법상 법인의 분할로 인한 자산의 취득가액은 장부가액을 원칙으로 한다. (O/X)",
                answer: "X",
                explanation: "시가를 원칙으로 한다. 다만, 적격분할의 경우 장부가액을 승계할 수 있다."
            },
            {
                question: "법인세법상 법인세의 감면세액은 최저한세액 계산 시 고려되지 않는다. (O/X)",
                answer: "X",
                explanation: "감면세액은 최저한세액 계산 시 고려된다."
            },
            {
                question: "법인세법상 원천징수세액은 법인세 납부세액에서 공제된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 가산세는 세액공제 대상이 아니다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 수정신고를 통해 추가로 납부할 세액이 발생하면 가산세가 부과된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 과세표준을 결정하는 경우 장부와 증빙에 의하여야 한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 장부와 증빙이 없는 경우에도 추계에 의하여 과세할 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 사업연도를 변경하는 경우, 변경 후 최초 사업연도는 1년을 초과할 수 없다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 기부금 한도액 계산 시 이월결손금은 차감하지 않는다. (O/X)",
                answer: "X",
                explanation: "기부금 한도 계산 시 이월결손금을 차감한 소득금액을 기준으로 한다."
            },
            {
                question: "법인세법상 지정기부금은 사회복지법인 등에 지출한 기부금에 한한다. (O/X)",
                answer: "X",
                explanation: "지정기부금은 법정기부금 외에 지정된 단체에 지출한 기부금이다."
            },
            {
                question: "법인세법상 비지정기부금은 전액 손금불산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 법인이 지급한 퇴직연금 불입액은 전액 손금에 산입된다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 재고자산의 평가는 시가법과 원가법 중 선택할 수 있다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 유형자산의 취득가액은 구입원가에 부대비용을 포함한다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법상 무상으로 받은 자산은 익금에 산입되지 않는다. (O/X)",
                answer: "X",
                explanation: "무상으로 받은 자산은 자산수증이익으로 익금에 산입된다."
            },
            {
                question: "법인세법상 유상감자의 경우, 감자차익은 익금에 산입된다. (O/X)",
                answer: "X",
                explanation: "감자차익은 자본잉여금으로 익금에 해당하지 않는다."
            },
            {
                question: "법인세법상 주식할인발행차금은 손금에 산입되지 않는다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "법인세법에 특별한 규정이 없는 경우, 회계처리는 기업회계기준을 따른다. (O/X)",
                answer: "O",
                explanation: ""
            },
            {
                question: "주식회사의 설립 시 발기인이 주식의 일부만 인수하는 것은 허용되지 않는다. (O/X)",
                answer: "X",
                explanation: "모집설립의 경우 발기인은 주식의 일부만 인수하고 나머지는 모집합니다. 발기설립 시에만 발기인이 전부 인수합니다. (상법 제295조)"
            },
            {
                question: "회사채는 주식과 달리 의결권이 없다. (O/X)",
                answer: "O",
                explanation: "회사채(사채)는 채무증권으로, 이자를 받고 원금을 상환받는 것이 목적이며, 주식처럼 의결권을 가지지 않습니다."
            },
            {
                question: "유한책임회사의 사원은 정관으로 정하는 바에 따라 출자 외에 다른 재산을 회사에 출자할 의무를 부담할 수 있다. (O/X)",
                answer: "X",
                explanation: "유한책임회사의 사원은 출자금액을 한도로 책임을 지므로, 출자 외에 다른 재산을 회사에 출자할 의무를 부담하게 할 수 없습니다. 이는 유한책임의 본질에 반합니다."
            },
            {
                question: "지배인의 대리권은 선임된 지점에 한하여 효력이 미친다. (O/X)",
                answer: "O",
                explanation: "지배인은 선임된 지점의 영업에 관한 사항에 한하여 대리권이 효력이 미칩니다. (상법 제11조)"
            },
            {
                question: "상법상 회사의 영업양도는 이사회의 결의만으로 충분하다. (O/X)",
                answer: "X",
                explanation: "영업의 전부 또는 중요한 일부의 양도는 주주총회의 특별결의가 필요합니다. (상법 제374조)"
            },
            {
                question: "주식회사는 주주에게 이익배당 외에 중간배당을 할 수 없다. (O/X)",
                answer: "X",
                explanation: "주식회사는 정관으로 정하는 바에 따라 영업연도 중에 이사회 결의로 중간배당을 할 수 있습니다. (상법 제462조의3)"
            },
            {
                question: "주식회사의 이사는 회사에 손해가 발생하더라도 고의 또는 중과실이 없는 한 책임지지 않는다. (O/X)",
                answer: "O",
                explanation: "이사의 회사에 대한 손해배상책임은 고의 또는 과실이 있는 경우에 발생합니다. 특히 제3자에 대한 책임은 고의 또는 중과실이 있어야 합니다. (상법 제399조, 제401조)"
            },
            {
                question: "회사의 청산인은 주주총회의 결의로 해임할 수 있다. (O/X)",
                answer: "O",
                explanation: "청산인은 주주총회의 결의로 언제든지 해임할 수 있습니다. (상법 제537조)"
            },
            {
                question: "합병으로 인하여 소멸하는 회사의 등기부에 기재된 사항은 모두 존속하는 회사에 승계된다. (O/X)",
                answer: "O",
                explanation: "합병은 포괄승계이므로 소멸회사의 모든 권리, 의무, 자산, 부채 등은 존속회사에 승계됩니다."
            },
            {
                question: "주식회사는 본점 소재지 외의 곳에 지점을 설치할 수 있다. (O/X)",
                answer: "O",
                explanation: "회사는 업무상 필요한 경우 본점 외의 장소에 지점을 설치할 수 있습니다."
            },
            {
                question: "유한회사의 사원은 이사가 아닌 경우에도 업무집행권을 가질 수 있다. (O/X)",
                answer: "O",
                explanation: "유한회사는 사원 스스로 업무집행을 하는 것이 원칙이므로, 이사가 아닌 사원도 정관에 따라 업무집행권을 가질 수 있습니다."
            },
            {
                question: "합명회사의 사원은 다른 사원의 동의 없이 지분을 양도할 수 없다. (O/X)",
                answer: "O",
                explanation: "합명회사의 사원 지분 양도는 다른 사원 전원의 동의가 있어야 합니다. 이는 인적회사의 특성 때문입니다. (상법 제197조)"
            },
            {
                question: "주주명부의 작성 및 비치는 이사의 의무사항이다. (O/X)",
                answer: "O",
                explanation: "이사는 주주명부를 작성하고 본점에 비치하여야 하며, 주주와 채권자는 열람 또는 등사를 청구할 수 있습니다. (상법 제352조)"
            },
            {
                question: "자본금 감소는 발행주식수를 줄이거나 1주의 금액을 줄이는 방법으로 할 수 있다. (O/X)",
                answer: "O",
                explanation: "자본금 감소는 주식 병합, 주식 소각, 1주의 금액 감소 등의 방법으로 할 수 있습니다. (상법 제439조)"
            },
            {
                question: "상업등기는 공시의 원칙이 적용된다. (O/X)",
                answer: "O",
                explanation: "상업등기는 거래의 안전을 위해 등기된 사항을 일반에게 공시함으로써 신뢰를 보호하는 공시의 원칙이 적용됩니다."
            },
            {
                question: "주식회사의 이사가 되는 자는 반드시 대한민국 국적을 가지고 있어야 한다. (O/X)",
                answer: "X",
                explanation: "이사의 자격에 국적 제한은 없습니다. 외국인도 주식회사 이사가 될 수 있습니다."
            },
            {
                question: "감사위원회는 이사 중에서 선임하며, 독립적인 지위를 가진다. (O/X)",
                answer: "O",
                explanation: "감사위원회는 이사 중에서 선임하되, 사외이사가 3분의 2 이상이어야 하며, 이사회 내에서 독립적인 감사의 역할을 수행합니다."
            },
            {
                question: "회사의 해산 시에는 잔여재산 분배 전 채권자들에게 채무를 변제해야 한다. (O/X)",
                answer: "O",
                explanation: "청산 절차에서 채무 변제는 잔여재산 분배에 우선합니다. (상법 제260조)"
            },
            {
                question: "주식회사는 다른 회사와 합병하거나 다른 회사를 흡수합병할 수 있다. (O/X)",
                answer: "O",
                explanation: "주식회사는 다른 회사와 합병하여 소멸하거나(피합병회사), 다른 회사를 흡수하여 존속할 수 있습니다(흡수합병). (상법 제174조, 제520조)"
            },
            {
                question: "상법상 회사의 영업은 양도할 수 있으나, 양수인은 양도인의 채무를 승계하지 않는다. (O/X)",
                answer: "X",
                explanation: "영업양도의 경우 양수인은 원칙적으로 양도인의 채무를 승계하지 않지만, 상호를 계속 사용하는 경우 등에는 예외적으로 채무를 승계하는 것으로 봅니다. (상법 제42조)"
            },
            {
                question: "주주총회의 소집절차에 하자가 있더라도 결의 내용이 적법하다면 그 결의는 유효하다. (O/X)",
                answer: "X",
                explanation: "주주총회 결의는 소집절차의 하자, 결의 방법의 하자, 결의 내용의 하자에 따라 각각 취소, 무효, 부존재의 사유가 될 수 있습니다. 소집절차의 하자가 있으면 결의취소의 소 대상이 됩니다. (상법 제376조)"
            },
            {
                question: "유한회사의 사원은 간접적으로 회사 채무에 대한 책임을 진다. (O/X)",
                answer: "X",
                explanation: "유한회사의 사원은 '출자액을 한도로' 책임을 지는 것이지, 채무에 대해 직접 또는 간접적으로 책임지는 것이 아닙니다. 유한책임은 채무에 대한 책임이 아닌, 출자 이행 의무에 대한 책임입니다."
            },
            {
                question: "주식회사는 주주총회의 결의로 법정준비금을 감소할 수 없다. (O/X)",
                answer: "X",
                explanation: "법정준비금(자본준비금, 이익준비금)은 결손 보전을 위해 주주총회의 특별결의로 감소할 수 있습니다. (상법 제459조, 제460조)"
            },
            {
                question: "지배인의 대리권은 법률에 의하여 정해지므로, 정관이나 이사회 결의로 이를 제한할 수 없다. (O/X)",
                answer: "X",
                explanation: "지배인의 대리권은 법률에 의해 정해지지만, 이사회 결의 등으로 이를 제한할 수 있습니다. 다만, 그 제한은 등기하지 않으면 선의의 제3자에게 대항할 수 없습니다. (상법 제11조)"
            },
            {
                question: "상업사용인은 영업주에게 손해를 가한 경우 그 손해를 배상할 책임이 없다. (O/X)",
                answer: "X",
                explanation: "상업사용인이 영업주의 업무를 수행하다가 고의 또는 과실로 영업주에게 손해를 가한 경우, 당연히 손해배상책임을 집니다."
            },
            {
                question: "주식회사는 언제든지 유한회사로 조직변경할 수 있다. (O/X)",
                answer: "X",
                explanation: "조직변경은 일정한 요건과 절차(주주총회 특별결의, 채권자 보호 절차 등)를 거쳐야 가능하며, 언제든지 자유롭게 할 수 있는 것은 아닙니다. (상법 제604조 이하)"
            },
            {
                question: "감사는 회사 또는 자회사에 대하여 소송을 제기할 수 없다. (O/X)",
                answer: "X",
                explanation: "감사는 회사에 대하여 또는 회사가 이사에 대하여 소송을 제기하는 경우 회사 대표의 권한을 가집니다. (상법 제414조의2)"
            },
            {
                question: "합병 시 소멸하는 회사의 주주에게 합병 교부금을 지급할 수 있다. (O/X)",
                answer: "O",
                explanation: "합병 시 소멸회사 주주에게 주식 대신 합병 교부금(현금 등)을 지급하는 것도 가능합니다. (상법 제523조)"
            },
            {
                question: "회사의 해산 등기는 청산종결 등기와 동시에 이루어진다. (O/X)",
                answer: "X",
                explanation: "회사의 해산 등기와 청산종결 등기는 별개입니다. 해산 등기는 해산 사유 발생 시 이루어지고, 청산종결 등기는 청산 절차가 완료된 후에 이루어집니다."
            },
            {
                question: "주식회사의 이사회는 대표이사가 소집하는 것이 원칙이다. (O/X)",
                answer: "O",
                explanation: "이사회는 대표이사 또는 이사회 규정에 정해진 이사가 소집합니다. (상법 제390조)"
            },
            {
                question: "유한회사의 사원은 정관으로 그 책임 한도를 자유롭게 정할 수 있다. (O/X)",
                answer: "X",
                explanation: "유한회사의 사원은 '출자액을 한도로' 책임을 지는 것이며, 정관으로 이 책임 한도를 임의로 자유롭게 정할 수 없습니다. 상법상 유한책임이 그 본질입니다. (상법 제551조)"
            },
            {
                question: "주주명부 폐쇄는 반드시 정관에 규정이 있어야 한다. (O/X)",
                answer: "X",
                explanation: "주주명부 폐쇄는 정관에 규정이 없더라도 이사회의 결의로 할 수 있습니다. 다만, 정관에 규정을 두는 것이 일반적입니다. (상법 제354조)"
            },
            {
                question: "이사 선임 시 주주총회는 정관에 따라 주주가 아닌 자를 이사로 선임할 수 있다. (O/X)",
                answer: "O",
                explanation: "이사는 반드시 주주여야 하는 것은 아니므로, 정관에 특별한 제한이 없으면 주주가 아닌 자도 이사로 선임될 수 있습니다."
            },
            {
                question: "회사가 채무를 변제하기 전에 주주에게 이익을 배당하는 것은 허용되지 않는다. (O/X)",
                answer: "O",
                explanation: "회사는 이익배당을 할 때 채권자 보호를 위해 일정한 재무 건전성 요건을 충족해야 하며, 채무 변제에 우선하여 이익 배당을 할 수 없습니다. (상법 제462조)"
            },
            {
                question: "주식회사의 이사 선임은 주주총회의 보통결의 사항이다. (O/X)",
                answer: "O",
                explanation: "이사의 선임은 주주총회 보통결의로 합니다. (상법 제382조)"
            },
            {
                question: "주식회사의 해산은 주주총회 결의 외에 법원의 명령으로도 가능하다. (O/X)",
                answer: "O",
                explanation: "회사의 해산 사유에는 법원의 해산 명령 또는 판결도 포함됩니다. (상법 제520조의2)"
            },
            {
                question: "합자회사의 유한책임사원은 회사에 대하여 출자의무를 부담하며, 이는 현물출자로도 가능하다. (O/X)",
                answer: "O",
                explanation: "유한책임사원은 금전 또는 현물로 출자할 수 있습니다. (상법 제272조)"
            },
        ];

        /**
         * Loads embedded quiz data synchronously.
         * @returns {Promise<Array>} Quiz data array
         */
        async function loadQuizData() {
            return corporationTaxQuizData; // Changed to new quiz data
        }

        // ============================ Quiz start and initialization ============================
        /**
         * Initializes and starts the quiz.
         * @param {number} numQuestions - Number of questions to play
         */
        async function startQuiz(numQuestions) {
            allQuizData = await loadQuizData(); // Load embedded quiz data
            if (allQuizData.length === 0) {
                showMessage("앗! 퀴즈 문제를 찾을 수 없어... 😥");
                showScreen('start');
                return;
            }

            // If requested number of questions is more than total questions, use all questions
            if (numQuestions > allQuizData.length) {
                quizTotalQuestions = allQuizData.length;
                showMessage(`요청한 문제 수(${numQuestions}개)가 전체 문제 수(${allQuizData.length}개)보다 많습니다. 전체 ${quizTotalQuestions}문제를 사용해요!`);
            } else {
                quizTotalQuestions = numQuestions;
            }

            // Shuffle all questions and slice by requested number
            const shuffledAllQuestions = [...allQuizData];
            shuffleArray(shuffledAllQuestions);
            currentQuizData = shuffledAllQuestions.slice(0, quizTotalQuestions);

            // Initialize
            currentQuestionIndex = 0;
            score = 0; // Reset raw score
            incorrectQuestions = [];
            selectedChoice = null;
            isAnswerChecked = false;
            timer = 0; // Reset timer
            startTimer(); // Start the timer

            showScreen('quiz');
            updateQuizHeaderVisibility(true); // Show quiz header
            questionChoicesArea.classList.remove('hidden'); // Show choices area
            quizControls.classList.remove('hidden'); // Show quiz control buttons
            displayQuestion();
            playStartSound(); // Play sound on quiz start
        }

        /**
         * Restarts the quiz (full or incorrect questions).
         * @param {number|'incorrect'} mode - Number of questions to restart with, or 'incorrect' for incorrect questions
         */
        function restartQuiz(mode) {
            if (mode === 'incorrect') {
                currentQuizData = [...incorrectQuestions]; // Set quiz data to incorrect questions
                if (currentQuizData.length === 0) {
                    showMessage('와! 틀린 문제가 하나도 없어! 대단해! 👍');
                    showScreen('end'); // Stay on end screen if no incorrect questions
                    return;
                }
                shuffleArray(currentQuizData); // Shuffle incorrect questions too
                quizTotalQuestions = currentQuizData.length;
            } else {
                const shuffledAllQuestions = [...allQuizData];
                shuffleArray(shuffledAllQuestions);
                currentQuizData = shuffledAllQuestions.slice(0, quizTotalQuestions);
            }

            // Initialize
            currentQuestionIndex = 0;
            score = 0; // Reset raw score
            incorrectQuestions = [];
            selectedChoice = null;
            isAnswerChecked = false;
            timer = 0; // Reset timer
            startTimer(); // Start the timer

            showScreen('quiz');
            updateQuizHeaderVisibility(true); // Show quiz header
            questionChoicesArea.classList.remove('hidden'); // Show choices area
            quizControls.classList.remove('hidden'); // Show quiz control buttons
            displayQuestion();
            playStartSound(); // Play sound on quiz restart
        }

        /**
         * Starts the review mode for incorrect questions.
         */
        function startReviewMode() {
            restartQuiz('incorrect'); // Call restart quiz with 'incorrect' mode
        }

        // ============================ Timer functions ============================
        /**
         * Starts the quiz timer.
         */
        function startTimer() {
            if (timerIntervalId) {
                clearInterval(timerIntervalId);
            }
            timerIntervalId = setInterval(() => {
                timer++;
                updateTimerDisplay();
            }, 1000);
        }

        /**
         * Stops the quiz timer.
         */
        function stopTimer() {
            clearInterval(timerIntervalId);
            timerIntervalId = null;
        }

        /**
         * Updates the timer display in MM:SS format.
         */
        function updateTimerDisplay() {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ============================ Display functions ============================
        /**
         * Displays the current question and its choices.
         */
        function displayQuestion() {
            // Update question count display
            questionCount.textContent = `문제 ${currentQuestionIndex + 1} / ${quizTotalQuestions}`;
            scoreDisplay.textContent = `별 점수: ${score} ✨`; // Displays raw score during quiz

            const question = currentQuizData[currentQuestionIndex];
            questionText.textContent = question.question;
            
            // Clear previous choices and reset styles
            questionChoicesArea.innerHTML = `
                <div class="p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition duration-200 ease-in-out text-gray-800 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" data-choice="O">O (동그라미)</div>
                <div class="p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition duration-200 ease-in-out text-gray-800 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" data-choice="X">X (엑스)</div>
            `;

            // Attach event listeners to the new O/X choice elements
            Array.from(questionChoicesArea.children).forEach(choiceDiv => {
                choiceDiv.addEventListener('click', () => {
                    if (!isAnswerChecked) { // Ensure only one selection/check per question
                        playButtonClickSound(); // Play sound immediately on selection
                        selectChoice(choiceDiv.dataset.choice); // Visually select
                        checkAnswer(); // Call checkAnswer logic
                        // Disable choices after an answer is submitted
                        Array.from(questionChoicesArea.children).forEach(c => {
                            c.style.pointerEvents = 'none';
                            c.classList.add('cursor-not-allowed'); // Add a visual cue for disabled
                        });
                    }
                });
            });

            // Reset feedback and button text
            feedbackExplanationArea.classList.add('hidden');
            feedbackText.textContent = '';
            explanationText.textContent = '';
            checkNextButton.textContent = '다음 문제로 Go! 👉'; // Button text is always "다음 문제" after a choice is made
            selectedChoice = null; // Clear selected choice
            isAnswerChecked = false; // Reset answer checked flag for the *new* question
            resetChoiceStyles(); // Reset choice styles and re-enable pointer events for new question
        }

        /**
         * Handles choice selection.
         * @param {string} choice - The selected choice ('O' or 'X')
         */
        function selectChoice(choice) {
            resetChoiceStyles(); // Clear previous selection styles
            selectedChoice = choice;
            const selectedChoiceElement = questionChoicesArea.querySelector(`[data-choice="${choice}"]`);
            selectedChoiceElement.classList.add(
                'bg-blue-200', 'border-blue-500' // Light mode selection styles
            );
            // Apply dark mode specific selection styles
            if (document.documentElement.classList.contains('dark')) {
                selectedChoiceElement.classList.add('dark:selected-choice-style'); // Apply custom class for dark mode
            }
        }

        /**
         * Resets the styles of all choices.
         */
        function resetChoiceStyles() {
            Array.from(questionChoicesArea.children).forEach(child => {
                child.classList.remove(
                    'bg-blue-200', 'border-blue-500', // selected (light mode)
                    'bg-green-100', 'border-green-400', // correct (light mode)
                    'bg-red-200', 'border-red-500',     // incorrect (light mode)
                    'dark:selected-choice-style', // Remove custom dark mode selected class
                    'dark:bg-green-700', 'dark:border-green-400', // correct (dark mode)
                    'dark:bg-red-600', 'dark:border-red-300' // incorrect (dark mode)
                );
                child.style.pointerEvents = 'auto'; // Re-enable pointer events for choices
                child.classList.remove('cursor-not-allowed'); // Remove disabled cursor
            });
        }

        /**
         * Checks the selected answer (called immediately when a choice is made).
         */
        function checkAnswer() {
            isAnswerChecked = true; // Set flag to indicate answer has been checked
            checkNextButton.textContent = '다음 문제로 Go! 👉'; // Change button text to "다음 문제"
            feedbackExplanationArea.classList.remove('hidden'); // Show feedback area

            const currentQuestion = currentQuizData[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;
            const selectedChoiceElement = questionChoicesArea.querySelector(`[data-choice="${selectedChoice}"]`);
            const correctChoiceElement = questionChoicesArea.querySelector(`[data-choice="${correctAnswer}"]`);

            // Highlight correct answer
            correctChoiceElement.classList.add('bg-green-100', 'border-green-400', 'dark:bg-green-700', 'dark:border-green-400');

            if (selectedChoice === correctAnswer) {
                score++; // Increment raw score
                feedbackText.textContent = '딩동댕! 잘했어!  ';
                // Remove previous error state colors and add success state colors including dark mode variants
                feedbackText.classList.remove('text-red-600', 'dark:text-red-400');
                feedbackText.classList.add('text-green-600', 'dark:text-green-400');
                playCorrectSound(); // Play correct sound
            } else {
                feedbackText.textContent = '아쉬워! ㅠㅠ 다시 생각해볼까? 🧐';
                // Remove previous success state colors and add error state colors including dark mode variants
                feedbackText.classList.remove('text-green-600', 'dark:text-green-400');
                feedbackText.classList.add('text-red-600', 'dark:text-red-400');
                // Ensure selected incorrect answer removes selection highlight properly and applies incorrect style
                selectedChoiceElement.classList.remove('bg-blue-200', 'border-blue-500', 'dark:selected-choice-style'); // Remove selected style
                selectedChoiceElement.classList.add('bg-red-200', 'border-red-500', 'dark:bg-red-600', 'dark:border-red-300'); // Add incorrect style
                incorrectQuestions.push(currentQuestion); // Add to incorrect questions
                playIncorrectSound(); // Play incorrect sound
            }
            explanationText.textContent = `꼼꼼 해설: ${currentQuestion.explanation}`;
            scoreDisplay.textContent = `별 점수: ${score} ✨`; // Update score immediately (raw score)
        }

        /**
         * Moves to the next question or ends the quiz (now always called by checkNextButton).
         */
        function checkOrNextQuestion() {
            moveToNextQuestion();
            playButtonClickSound(); // Play sound on button click
        }

        /**
         * Moves to the next question or ends the quiz.
         */
        function moveToNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizTotalQuestions) {
                displayQuestion();
            } else {
                endQuiz();
            }
        }

        /**
         * Ends the quiz and displays the final score.
         */
        function endQuiz() {
            stopTimer(); // Stop the timer
            showScreen('end');

            // Calculate final score based on 100-point scale
            const finalCalculatedScore = (score / quizTotalQuestions) * 100;
            const correctCount = score;
            const incorrectCount = incorrectQuestions.length;

            // Display all information in the finalScoreDisplay element
            finalScoreDisplay.textContent = `(총 ${quizTotalQuestions}문제, ${correctCount}개 정답, ${incorrectCount}개 오답! 대단해! 🎉 점수: ${finalCalculatedScore.toFixed(0)}점)`;
            
            playEndSound(); // Play end sound
            updateQuizHeaderVisibility(false); // Hide quiz header
            endQuizButtonsArea.classList.remove('hidden'); // Ensure buttons are visible on end screen
        }

        /**
         * Controls which screen is visible.
         * @param {'start'|'quiz'|'end'} screenName - The name of the screen to show
         */
        function showScreen(screenName) {
            startScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            endQuizScreen.classList.add('hidden');

            // Always hide settings initially, then show only if it's the start screen
            settingsControls.classList.add('hidden'); // Hide settings for all screens by default

            if (screenName === 'start') {
                startScreen.classList.remove('hidden');
                settingsControls.classList.remove('hidden'); // Show settings only on start screen
            } else if (screenName === 'quiz') {
                quizScreen.classList.remove('hidden');
                // settingsControls remains hidden
            } else if (screenName === 'end') {
                endQuizScreen.classList.remove('hidden');
                // settingsControls remains hidden
            }
        }

        /**
         * Toggles the visibility of the quiz header elements.
         * @param {boolean} show - True to show, false to hide
         */
        function updateQuizHeaderVisibility(show) {
            if (show) {
                quizHeader.classList.remove('hidden');
            } else {
                quizHeader.classList.add('hidden');
            }
        }

        /**
         * Shuffles an array randomly (Fisher-Yates shuffle algorithm).
         * @param {Array} array - The array to shuffle
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        // ============================ Event Listeners ============================

        // Start screen button event listeners
        start10Button.addEventListener('click', () => startQuiz(10));
        start20Button.addEventListener('click', () => startQuiz(20));
        start40Button.addEventListener('click', () => startQuiz(40));

        // This button now always moves to the next question or ends the quiz
        checkNextButton.addEventListener('click', checkOrNextQuestion);
        endEarlyButton.addEventListener('click', endQuiz);
        // 'Restart Full Quiz' button restarts with the current quiz session's question count
        restartFullQuizButton.addEventListener('click', () => restartQuiz(quizTotalQuestions));
        reviewIncorrectButton.addEventListener('click', startReviewMode);
        goToHomeButton.addEventListener('click', () => {
            location.reload(); // Go to home screen = reload page
        });

        // Dark mode toggle event listener
        darkModeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            // Toggle icons based on dark mode status
            if (document.documentElement.classList.contains('dark')) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
        });

        // Sound toggle event listener
        soundToggle.addEventListener('click', () => {
            isSoundEnabled = !isSoundEnabled; // Toggle sound status
            // Update Tone.Destination.mute immediately
            Tone.Destination.mute = !isSoundEnabled;
            // Toggle icons based on sound status
            if (isSoundEnabled) {
                speakerIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
            } else {
                speakerIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
            }
        });


        // ============================ Quiz initialization and start on DOMContentLoaded ============================
        document.addEventListener('DOMContentLoaded', () => {
            // Initially show only the start screen, hide all quiz related elements
            startScreen.classList.remove('hidden');
            quizScreen.classList.add('hidden'); // Explicitly hide quizScreen
            endQuizScreen.classList.add('hidden'); // Explicitly hide endQuizScreen

            quizHeader.classList.add('hidden');
            questionChoicesArea.classList.add('hidden');
            feedbackExplanationArea.classList.add('hidden');
            quizControls.classList.add('hidden');
            endQuizButtonsArea.classList.add('hidden'); // This line was important!
            scoreDisplay.classList.add('hidden');

            // Settings control should only be visible on the start screen when the page loads
            showScreen('start'); // This handles visibility of settingsControls correctly

            // Set initial dark mode icon based on system preference or saved state
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }

            // Set initial sound icon (default: on)
            if (isSoundEnabled) {
                speakerIcon.classList.remove('hidden');
                muteIcon.classList.add('hidden');
            } else {
                speakerIcon.classList.add('hidden');
                muteIcon.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
 